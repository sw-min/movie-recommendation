<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <style>
    .dotchart {
      margin-left: 50px;
      margin-right: 50px;
    }
    .svgclass {
      border-style: solid;
      border-color: black;
      padding: 5px;
      
    }
    .content {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }
    .wrapperColumn {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      width: 40%;
    }
    .wrapperRow {
      display: flex;
      flex-direction: row;
      align-items: center;
      justify-content: center;
    }
    .filter {
      padding-right: 50px;
    }

    .filterbuttons button {
      width: 5rem;
      min-height: 5rem;
      border-radius: 0.5rem;
      border: 2px solid #b5bfd9;
      background-color: #fff;
      box-shadow: 0 5px 10px rgba(lightgrey, 0.1);
      transition: 0.15s ease;
      cursor: pointer;
      position: relative
    }
    .filterbuttons button:hover {
      border-color: black;
		}
    .filterbuttons button:active

    .movie_rec {
      font-family: Arial, Helvetica, sans-serif;
    }

    .title {
      font-weight: 600;
      font-style: italic;
    }

    .year {
      font-size: small;
    }

    .genre {
      font-style: italic;
      color: steelblue;
    }

    .recTitle {
      font-family: Arial, Helvetica, sans-serif;
      font-size: xx-large;
      font-weight: 800;
    }

  </style>
  <title>INFO 3300-Project 2</title>
</head>

<body>
  <h1>INFO 3300 - Project 2</h1>
  <h3>Members: Josette, Laura, Peter, Sung Woo</h3>

  <div class="content">
    <div class="wrapperRow">
      <div class="wrapperColumn">
        <div class="filter">
          <p> Instructions: <br>Choose a genre and then click any of the following preferences to see how unique your movie taste is compared to IMDB's top rated movies! 
            <br>
            - If you add multiple preferences, add from top to bottom
            <br>
            - If you recieve a 0% and want to keep filtering, refresh the page or unclick and reclick a genre to start over
            <br>
            - Only click one box per question.
          </p>
          <h3> Select a genre: </h3>
          <div class="filterbuttons" id="genrebuttons"></div>
          <h3> What decade of movies do you prefer?</h3>
          <div class="filterbuttons" id="erabuttons"></div>
          <h3> How long do you want the runtime?</h3>
          <div class="filterbuttons" id="rtbuttons"></div>
          <h3> Do you prefer a specfic director?</h3>
          <div class="filterbuttons" id="directorbuttons"></div>
          <h3> Do you prefer a production company?</h3>
          <div class="filterbuttons" id="companybuttons"></div>
        </div>
      </div>
      <div class="wrapperColumn">
        <div class="dotchart">
          <h3>How unique is your movie taste?</h3>
          <svg class = "svgclass" id="svg1" height="500" width="500"></svg> 
          <h4>score: insert message according on percentage</h4>
        </div>
        <div id="recommendations"></div>
      </div>
    </div>
  </div>

    
  <script>
      // Request data
      const genrebuttons = async function () {
        console.log('running genrebuttons')
      const imdb_small = await d3.csv("imdb_100.csv");
      const data = imdb_small
      let filterTags = [];
      let dataset = [];

      // Genre filter
      const genres = ["Drama", "Crime", "Action", "Biography", "History", "Adventure", "Sci-Fi", "Fantasy", "Thriller", "Comedy", "War", "Romance", "Horror", "Family", "Western", "Film-Noir", "Music", "Musical", "Mystery", "Animation"]
      
      // Creating buttons for genres
      genres.forEach(function(i) {
        // console.log('in genre for each loop')

        d3.select('div#genrebuttons')
          .append("button")
          .attr("id", i)
          .text(i)
          .on("click", function() {
              if(!filterTags.includes(i)) {
                filterTags.push(i);
                filterdata = data.filter(function(d){ return d['genre'].includes(i); });
                // update(filterdata);
                //count rows in filter data
                console.log("Added " + i + "!")
                percent = filterdata.length;
                console.log(filterTags);
                dataset = filterdata;
                updateMovieList(filterdata);

                map.select("#preferencePERCENT").remove();
                map.append("text").text(percent + "% of movies match your preferences.")
                  .attr("id", "preferencePERCENT")
                  .attr("x", 0)
                  .attr("y", 10)
                  .style("font-size", 24);
                  d3.select(`button#${i}`).style("border-color", "black");


              } else {
                filterTags.splice(filterTags.indexOf(i), 1);
                // filterdata = data.filter(function(d){ return d['genre'].includes(!filterTags); });
                map.select("#preferencePERCENT").remove();
                console.log("Removed!")
                console.log(filterdata.length);
                console.log(filterTags)
                d3.select(`button#${i}`).style("border-color", "b5bfd9");

              }
          });
            //count rows in filter data
            //move that many dots to the bottom half of the svg
        // d3.select(`div#${i}`)
        //   .append("label")
        //   .attr("for", i)
        //   .text(i);


      })



      // Era filter
      const eras = ["1920s", "1930s", "1940s", "1950s", "1960s", "1970s", "1980s", "1990s", "2000s", "2010s", "2020s"]

      eras.forEach(function(i) {
          console.log('in era for-each loop')
          d3.select("div#erabuttons")
            .append("button")
            .text(i)
            .on("click", function() {
                decade = i.slice(0,3)
                console.log(decade)
                filterdata = filterdata.filter(function(d){
                  return d['year'].includes(decade);
                })
                // update(filterdata);
                console.log(filterdata);
                //count rows in filter data
                percent = filterdata.length;
                updateMovieList(filterdata);
                console.log(percent);
                map.select("#preferencePERCENT").remove();
                  map.append("text").text(percent + "% of movies match your preferences.")
                    .attr("id", "preferencePERCENT")
                    .attr("x", 0)
                    .attr("y", 10);
                
                })

                //move that many dots to the bottom half of the svg
            })

        //duration filter

        const runtimes = ["60-90", "90-120", "120-150", "150-180", "180-210", "210-240"]

        runtimes.forEach(function(i) {
          console.log('in rt for-each loop')
          d3.select("div#rtbuttons")
            .append("button")
            .text(i)
            .on("click", function() {
                const interval = i.split('-')
                start = interval[0]
                end = interval[1]
                console.log(interval)
                console.log(start)
                console.log(end)
                filterdata = filterdata.filter(function(d){
                  return d['duration']>=start && d['duration']<=end;
                })
                // update(filterdata);
                //** 90-120 range not working??
                console.log(filterdata);
                //count rows in filter data
                percent = filterdata.length;
                updateMovieList(filterdata);
                console.log(percent);
                map.select("#preferencePERCENT").remove();
                  map.append("text").text(percent + "% of movies match your preferences.")
                    .attr("id", "preferencePERCENT")
                    .attr("x", 0)
                    .attr("y", 10);
                })
                //move that many dots to the bottom half of the svg
            })

        

        //repeat for next filter and feed in already-filtered filterdata array to layer the filters
        //count new number of dots each time and only have that amount display on the bottom
      
         //director filter 
           const directors = ['Alfred Hitchcock', 'Quentin Tarantino', 'Steven Spielberg', 'Christopher Nolan', 'David Fincher']

         directors.forEach(function(i) {
          console.log('in director for-each loop')
          d3.select("div#directorbuttons")
            .append("button")
            .text(i)
            .on("click", function() {
                console.log(i)
                filterdata = filterdata.filter(function(d){
                  return d['director'].includes(i);
                })
                // update(filterdata);
                //count rows in filter data
                console.log(filterdata);
                percent = filterdata.length;
                updateMovieList(filterdata);
                console.log(percent);
                map.select("#preferencePERCENT").remove();
                  map.append("text").text(percent + "% of movies match your preferences.")
                    .attr("id", "preferencePERCENT")
                    .attr("x", 0)
                    .attr("y", 10);
                 
                })
                //move that many dots to the bottom half of the svg
            })

          //company filter
          const production_companies = ['Paramount Pictures', 'Universal Pictures', 'Warner Bros.', 'Castle Rock Entertainment']

          production_companies.forEach(function(i) {
          console.log('in company for-each loop')
          d3.select("div#companybuttons")
            .append("button")
            .text(i)
            .on("click", function() {
                console.log(i)
                filterdata = filterdata.filter(function(d){
                  return d['production_company'].includes(i);
                })
                // update(filterdata);
                //count rows in filter data
                console.log(filterdata);
                percent = filterdata.length;
                updateMovieList(filterdata);
                console.log(percent);
                map.select("#preferencePERCENT").remove();
                  map.append("text").text(percent + "% of movies match your preferences.")
                    .attr("id", "preferencePERCENT")
                    .attr("x", 0)
                    .attr("y", 10);
                })
                
                //move that many dots to the bottom half of the svg
            })
      
  
     

      
     
      
      //HARDCODED DOT CHART CODE BELOW:

      const svg = d3.select("#svg1");
      const width = svg.attr("width");
      const height = svg.attr("height");
      const margin = {top: 10, right: 10, bottom: 10, left: 10};
      const chartWidth = width - margin.left - margin.right;
      const chartHeight = height - margin.top - margin.bottom;
      const map = svg.append("g")
                    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

      // const projectData = async function () {
       console.log('in async')

      //Movie names on the top 100 are 'original_title', top 1000 are 'Series_Title', and RT are 'Name'
      // const imdb_small = await d3.csv("imdb_100.csv");
      const imdb_large = await d3.csv("imdb_1000.csv");
      const rotten_tomatoes = await d3.csv("rotten_tomatoes.csv");

      console.log(imdb_small);
      // console.log(genre);
  




  const imdb_twenty = imdb_small.slice(0,20);
  // console.log(imdb_twenty);
  const imdb_forty = imdb_small.slice(20,40);
  const imdb_sixty = imdb_small.slice(40,60);
  const imdb_eighty = imdb_small.slice(60,80);
  const imdb_hundred = imdb_small.slice(80,100);
  
  let inc_x_t = chartWidth;
  imdb_twenty.forEach( d => {
        d.x = inc_x_t;
        d.y = 25;
        inc_x_t= inc_x_t - 8;
      });

  let inc_x_f = chartWidth;
  imdb_forty.forEach( d => {
        d.x = inc_x_f;
        d.y = 35;
        inc_x_f = inc_x_f - 8;
      });
      
  let inc_x_s = chartWidth;
  imdb_sixty.forEach( d => {
        d.x = inc_x_s;
        d.y = 45;
        inc_x_s = inc_x_s - 8;
      }); 
  
  let inc_x_e = chartWidth;
  imdb_eighty.forEach( d => {
        d.x = inc_x_e;
        d.y = 55;
        inc_x_e = inc_x_e - 8;
      }); 
  
  let inc_x_h = chartWidth;
  imdb_hundred.forEach( d => {
        d.x = inc_x_h;
        d.y = 65;
        inc_x_h = inc_x_h - 8;
      }); 

  map.selectAll("circle").data(imdb_small)
                          .join("circle")
                          .attr("r", 2)
                          .attr("cx", d => d.x) //want to evenly distribute circles on x axis
                          .attr("cy", d => d.y); //and evenly distribute in rows on y axis
                          // .attr("fill", //colors based on filter and y position)

  
  
  //circle drawing function for data visualization - josie

  //call this on click for each filter?
  // function movecircles(p) {
  // //for each number in percent:
  //   map.append(circle)
  //       .attr("r", 2)
  //       .attr("cx", ) //random? or in rows to look neater
  //       .attr("cy", ) //put on a range in upper half of chart (random or rows) 
  //       //do this with a scale and set domain and range??

  // //for each number in 100-percent:
  //   map.append(circle)
  //       .attr("r", 2)
  //       .attr("cx", ) //random? or in rows to look neater
  //       .attr("cy", ) //put on a range in upper half of chart (random or rows) 
  //       //do this with a scale and set domain and range?
  // }

  
  
  
  // Initial percentage text
  map.append("text").text("Press on some tags to see what percent of movies match!")
                  .attr("id", "preferencePERCENT")
                  .attr("x", 0)
                  .attr("y", 10);;

  // Handmade legend
  map.append("circle").attr("cx",200).attr("cy",130).attr("r", 2)
  map.append("circle").attr("cx",200).attr("cy",160).attr("r", 2).style("fill", "#FF0000")
  map.append("text").attr("x", 220).attr("y", 130).text("1 Movie that fits filter").style("font-size", "15px").attr("alignment-baseline","middle")
  map.append("text").attr("x", 220).attr("y", 160).text("1 Movie that doesn't fit filters").style("font-size", "15px").attr("alignment-baseline","middle")

  // MOVIE RECOMMENDATIONS SECTION
  const recCanvasHeight = 400;
  const recCanvasWidth = 500;
  const margins = {top: 10, right: 10, bottom: 50, left: 50};
  const recChartWidth = recCanvasWidth - margins.left - margins.right;
  const recChartHeight = recCanvasHeight - margins.top - margins.bottom;

  let recSVG = d3.select("div#recommendations").append("svg")
                  .attr("id", "movieRecSVG")
                  .attr("height", recCanvasHeight)
                  .attr("width", recCanvasWidth);

  const canvas = d3.select("svg#svg");

function updateMovieList (filteredMovies) {
  
  movieFilterList = filteredMovies.map((x) => x);
  let movieList = [];
  movieFilterList.forEach( movie => {
    let dict = {};
    dict["Title"] = movie["original_title"];
    dict["Year"] = movie["year"];
    dict["Genre"] = movie["genre"];
    //dict["Rating"] = movie["IMDB_Rating"];

    try{
    dict["Poster_Link"] = movie["Poster_Link"];
    }
    catch(err) {
      dict["Poster_Link"] = null;
    }
    movieList.push(dict);
  });

  updateMovieRecs(movieList);

}

  //Get top 3 movies
  const yScale = d3.scaleLinear().domain( [0, 3] )
                                 .range( [recChartHeight, 0] );

  recSVG.append("text")
        .attr("x", margins.top)
        .attr("y", margins.bottom)
        .text("Movie Recommendations")
        .attr("class", "recTitle");

  function updateMovieRecs (movieRecsArray) {
  d3.selectAll("svg#movieRecSVG > .movie_rec").remove();

  let movieRecs = movieRecsArray.slice(0, 3);
  console.log(movieRecs)
  
  movieRecs.forEach( (movie, i) => {
      let titleLength = Number(movie["Title"].length);

      //Title
      recSVG.append("text")
          .attr("x", margins.left + 100)
          .attr("y",  yScale(i) - 20)
          .text(movie["Title"])
          .attr("class", "title movie_rec");
      
      //Year
      recSVG.append("text")
        .attr("x", margins.left + 100)
        .attr("y",  yScale(i))
        .text( "(" + movie["Year"] + ")")
        .attr("class", "year movie_rec");

      // Genre
      recSVG.append("text")
        .attr("x", margins.left + 145)
        .attr("y",  yScale(i))
        .text(movie["Genre"])
        .attr("class", "genre movie_rec");
      
         // Runtime
         recSVG.append("text")
        .attr("x", margins.left + 100)
        .attr("y",  yScale(i) + 20)
        .text("Runtime: "+ movie["Runtime"] + " minutes") //Add percentage match!
        .attr("class", "permatch movie_rec");

      /* // Rating
      recSVG.append("text")
        .attr("x", recChartWidth - margins.left)
        .attr("y",  yScale(i) - 20)
        .text("Rating: " + movie["Rating"])
        .attr("class", "ratings movie_rec"); */
          
      if (movie["Poster_Link"] != null) {    
        recSVG.append("image")
        .attr("href", movie["Poster_Link"])
        .attr("x", margins.left)
        .attr("y", yScale(i) - 70)
        .attr("width", 75)
        .attr("height", 150)
        .attr("class", "movie_rec");}
      
      else {
        recSVG.append("image")
        .attr("href", "./static/not_found.jpeg")
        .attr("x", margins.left)
        .attr("y", yScale(i) - 70)
        .attr("width", 75)
        .attr("height", 150)
        .attr("class", "movie_rec"); };
    });
   
   
  }}
  genrebuttons();

//     }

// projectData();

   

  
    </script>
</div>




</body>
</html>

<!-- const runtimes = ["60-90", "90-120", "120-150", "150-180", "180-210", "210-240"]
const companies = [
  "3leven",
  "AMLF",
  "Aamir Khan Productions",
  "Aamir Khan Productions",
  "Alfred J. Hitchcock Productions",
  "Alfred J. Hitchcock Productions",
  "American Zoetrope",
  "Amuse",
  "Barunson E&A",
  "Bavaria Film",
  "Bold Films",
  "Brandywine Productions",
  "Bryna Productions",
  "Carolco Pictures",
  "Castle Rock Entertainment",
  "Castle Rock Entertainment",
  "Cecchi Gori Pictures",
  "Charles Chaplin Productions",
  "Charles Chaplin Productions",
  "Charles Chaplin Productions",
  "Charles Chaplin Productions",
  "Columbia Pictures",
  "Columbia Pictures",
  "Cristaldifilm",
  "DENTSU Music And Entertainment",
  "DreamWorks",
  "DreamWorks",
  "Edward Small Productions",
  "Egg Films",
  "Fantasy Films",
  "FortyFour Studios",
  "Fox 2000 Pictures",
  "Fox STAR Studios",
  "Gaumont",
  "Horizon Pictures (II)",
  "Liberty Films (II)",
  "Lucasfilm",
  "Lucasfilm",
  "Lucasfilm",
  "Marvel Studios",
  "Marvel Studios",
  "Melampo Cinematografica",
  "Metro-Goldwyn-Mayer (MGM)",
  "Metro-Goldwyn-Mayer (MGM)",
  "Metro-Goldwyn-Mayer (MGM)",
  "Miramax",
  "Mooz Films",
  "Nero-Film AG",
  "New Line Cinema",
  "New Line Cinema",
  "New Line Cinema",
  "New Line Cinema",
  "Newmarket Capital Group",
  "O2 Filmes",
  "Orion-Nova Productions",
  "Paramount Pictures",
  "Paramount Pictures",
  "Paramount Pictures",
  "Paramount Pictures",
  "Paramount Pictures",
  "Paramount Pictures",
  "Paramount Pictures",
  "PolyGram Filmed Entertainment",
  "Produzioni De Sica (PDS)",
  "Produzioni Europee Associate (PEA)",
  "Produzioni Europee Associate (PEA)",
  "Quad Productions",
  "R.P. Productions",
  "RKO Radio Pictures",
  "Rafran Cinematografica",
  "Shamley Productions",
  "Shinchosha Company",
  "Sony Pictures Entertainment (SPE)",
  "Strong Heart/Demme Production",
  "The Ladd Company",
  "The Mirisch Corporation",
  "The Weinstein Company",
  "Toho Company",
  "Toho Company",
  "Tokuma Shoten",
  "Touchstone Pictures",
  "Universal Pictures",
  "Universal Pictures",
  "Universal Pictures",
  "Universum Film (UFA)",
  "Vinod Chopra Productions",
  "Walt Disney Pictures",
  "Walt Disney Pictures",
  "Warner Bros.",
  "Warner Bros.",
  "Warner Bros.",
  "Warner Bros.",
  "Warner Bros.",
  "Warner Bros.",
  "Warner Bros.",
  "Warner Bros.",
  "Warner Bros.",
  "Warner Bros.",
  "Wiedemann & Berg Filmproduktion",
  "Zanuck/Brown Productions"
]
const directors = [
    "Aamir Khan, Amole Gupte",
    "Akira Kurosawa",
    "Akira Kurosawa",
    "Alfred Hitchcock",
    "Alfred Hitchcock",
    "Alfred Hitchcock",
    "Alfred Hitchcock",
    "Alper Caglar",
    "Andrew Stanton",
    "Anthony Russo, Joe Russo",
    "Anthony Russo, Joe Russo",
    "Billy Wilder",
    "Billy Wilder",
    "Billy Wilder",
    "Billy Wilder",
    "Bob Persichetti, Peter Ramsey",
    "Bong Joon Ho",
    "Brian De Palma",
    "Bryan Singer",
    "Chan-wook Park",
    "Charles Chaplin",
    "Charles Chaplin",
    "Charles Chaplin",
    "Charles Chaplin",
    "Christopher Nolan",
    "Christopher Nolan",
    "Christopher Nolan",
    "Christopher Nolan",
    "Christopher Nolan",
    "Christopher Nolan",
    "Damien Chazelle",
    "David Fincher",
    "David Fincher",
    "David Lean",
    "Fernando Meirelles, Kátia Lund",
    "Florian Henckel von Donnersmarck",
    "Francis Ford Coppola",
    "Francis Ford Coppola",
    "Francis Ford Coppola",
    "Frank Capra",
    "Frank Darabont",
    "Frank Darabont",
    "Fritz Lang",
    "Fritz Lang",
    "George Lucas",
    "George Roy Hill",
    "Giuseppe Tornatore",
    "Hayao Miyazaki",
    "Hayao Miyazaki",
    "Irvin Kershner",
    "Isao Takahata",
    "James Cameron",
    "Jonathan Demme",
    "Lana Wachowski, Lilly Wachowski",
    "Lee Unkrich, Adrian Molina",
    "Luc Besson",
    "Makoto Shinkai",
    "Martin Scorsese",
    "Martin Scorsese",
    "Martin Scorsese",
    "Michael Curtiz",
    "Milos Forman",
    "Milos Forman",
    "Mukesh Chhabra",
    "Nadine Labaki",
    "Nitesh Tiwari",
    "Olivier Nakache, Éric Toledano",
    "Orson Welles",
    "Peter Jackson",
    "Peter Jackson",
    "Peter Jackson",
    "Quentin Tarantino",
    "Quentin Tarantino",
    "Rajkumar Hirani",
    "Richard Marquand",
    "Ridley Scott",
    "Ridley Scott",
    "Robert Zemeckis",
    "Robert Zemeckis",
    "Roberto Benigni",
    "Roger Allers, Rob Minkoff",
    "Roman Polanski",
    "Sergio Leone",
    "Sergio Leone",
    "Sergio Leone",
    "Sergio Leone",
    "Sidney Lumet",
    "Stanley Donen, Gene Kelly",
    "Stanley Kubrick",
    "Stanley Kubrick",
    "Stanley Kubrick",
    "Stanley Kubrick",
    "Stanley Kubrick",
    "Steven Spielberg",
    "Steven Spielberg",
    "Steven Spielberg",
    "Todd Phillips",
    "Tony Kaye",
    "Vittorio De Sica",
    "Wolfgang Petersen"
] -->